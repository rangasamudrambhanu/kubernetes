# Install kubeadm, kubelet, and kubectl (Kubernetes v1.32)

This document explains how to install **kubeadm**, **kubelet**, and **kubectl** on Ubuntu, and provides a simple explanation of **cgroups and cgroup drivers** required for Kubernetes.

Official documentation reference:  
https://v1-32.docs.kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/

---

## Kubernetes Version

These instructions are for **Kubernetes v1.32**.

---

## 1. Update the apt package index and install prerequisites

```bash
sudo apt-get update
# apt-transport-https may be a dummy package; if so, it can be skipped
sudo apt-get install -y apt-transport-https ca-certificates curl gpg
```

---

## 2. Add the Kubernetes signing key

```bash
sudo mkdir -p -m 755 /etc/apt/keyrings
```

```bash
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.32/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
```

---

## 3. Add the Kubernetes apt repository

```bash
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.32/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list
```

---

## 4. Install kubelet, kubeadm, and kubectl

```bash
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
```

---

## 5. Enable the kubelet service (Optional)

```bash
sudo systemctl enable --now kubelet
```

---

## 6. Understanding Control Groups (cgroups)

On Linux, **control groups (cgroups)** are used to constrain resources allocated to processes.

Kubernetes uses cgroups to enforce:
- Pod CPU limits
- Pod memory limits

---

## 7. Who manages cgroups in Kubernetes?

1. Container Runtime (containerd / Docker / CRI-O)  
2. kubelet (node agent)

Both manage cgroups.

---

## 8. What is a cgroup driver?

A cgroup driver defines *how* cgroups are managed.

| Driver     | Meaning |
|------------|--------|
| systemd   | systemd manages cgroups |
| cgroupfs | runtime manages cgroups directly |

---

## 9. Golden Rule

**Container runtime and kubelet must use the SAME cgroup driver**.

If they do not match:
- kubelet fails
- node becomes NotReady
- pods do not start

---

## 10. Recommended Driver

Kubernetes recommends **systemd**.

Reasons:
- kubelet runs under systemd
- Linux is systemd-based
- more stable

---

## 11. Practical Configuration

```toml
SystemdCgroup = true
```

This means:
- containerd → systemd
- kubelet → systemd

---

## 12. kubeadm Auto Detection

Modern kubeadm auto-detects systemd for kubelet.

Explicit kubelet config may appear optional, but containerd config is mandatory.

---
