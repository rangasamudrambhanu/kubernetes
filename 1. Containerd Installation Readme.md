# Containerd Installation on Ubuntu 24.04 (Kubernetes Ready)

This guide explains how to prepare an **Ubuntu 24.04 EC2 instance (t3.medium)** and install **containerd** in a way that is fully compatible with **Kubernetes (kubeadm)**.

---

## Prerequisites

- Ubuntu 24.04
- EC2 instance (t3.medium or higher)
- SSH access using a `.pem` key
- Sudo privileges

---

## 1. Secure the SSH Key and Connect to the Instance

```bash
chmod 400 Kubernetes.pem
```

Restricts permissions on the private key. AWS requires this for SSH.

```bash
ssh -i Kubernetes.pem ubuntu@<public-ip>
```

Connects to the EC2 instance using SSH.

---

## 2. Configure Hostnames and Host Resolution

```bash
sudo vi /etc/hosts
```

Add:
```text
<private-ip-control-plane> control-plane
<private-ip-worker1>       worker1
<private-ip-worker2>       worker2
```

Allows Kubernetes nodes to communicate using hostnames.

```bash
sudo hostnamectl set-hostname control-plane
exec bash
```
## replace control-plane with worker1 and wroker2 when executing in worker nodes

Sets and reloads hostname.

---

## 3. Load Required Kernel Modules

```bash
sudo tee /etc/modules-load.d/k8s.conf > /dev/null <<'EOF'
overlay
br_netfilter
EOF
```

Loads required modules at boot.

```bash
sudo modprobe overlay
sudo modprobe br_netfilter
```

Loads modules immediately.

---

## 4. Configure Kernel Networking (sysctl)

```bash
sudo tee /etc/sysctl.d/k8s.conf > /dev/null <<'EOF'
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF
```

Required for Kubernetes networking.

```bash
sudo sysctl --system
```

Applies settings.

---

## 5. Disable Swap (Mandatory)

```bash
sudo swapoff -a
sudo sed -i.bak -r 's@(^\s*([^#\n]+\s+swap\s+.*)$)@#\2@g' /etc/fstab || true
```

Kubernetes does not support swap.

---

## 6. Install Containerd

```bash
sudo apt-get update
sudo apt-get -y install ca-certificates curl gnupg lsb-release apt-transport-https
sudo apt-get -y install containerd || sudo apt-get -y install containerd.io
```

Installs containerd.

---

## 7. Configure Containerd for Kubernetes

```bash
sudo mkdir -p /etc/containerd
sudo containerd config default | sudo tee /etc/containerd/config.toml > /dev/null
sudo sed -i 's/SystemdCgroup \?= \?false/SystemdCgroup = true/' /etc/containerd/config.toml
```

Enables systemd cgroup driver.

---

## 8. Start and Enable Containerd

```bash
sudo systemctl restart containerd
sudo systemctl enable containerd
```

---

## 9. Verify Installation

```bash
containerd --version
sudo systemctl status containerd
```

---

## References

- https://kubernetes.io/docs/setup/production-environment/container-runtimes/
- https://github.com/containerd/containerd
